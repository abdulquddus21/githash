"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/upload";
exports.ids = ["pages/api/upload"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload.js&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload.js&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\upload.js */ \"(api)/./pages/api/upload.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/upload\",\n        pathname: \"/api/upload\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_upload_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnVwbG9hZCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDdXBsb2FkLmpzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ29EO0FBQ3BEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcHJpdmF0ZS8/YjNmNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHVwbG9hZC5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VwbG9hZFwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3VwbG9hZFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/upload.js":
/*!*****************************!*\
  !*** ./pages/api/upload.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__]);\nformidable__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n// Supabase konfiguratsiyasi\nconst supabaseUrl = \"https://xzbwfoacsnrmgjmildcr.supabase.co\";\nconst supabaseServiceKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh6Yndmb2Fjc25ybWdqbWlsZGNyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODE5OTE3NSwiZXhwIjoyMDczNzc1MTc1fQ.t0u8Uy7D7N3KWgNthFTijhCucN4VcFc39QAPAwDYXfo\";\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey);\n// Bucket nomi\nconst BUCKET_NAME = \"uploads\";\n// Ruxsat berilgan file turlari\nconst ALLOWED_FILE_TYPES = {\n    images: [\n        \".jpg\",\n        \".jpeg\",\n        \".png\",\n        \".gif\",\n        \".webp\",\n        \".svg\",\n        \".bmp\",\n        \".tiff\"\n    ],\n    videos: [\n        \".mp4\",\n        \".avi\",\n        \".mkv\",\n        \".mov\",\n        \".wmv\",\n        \".flv\",\n        \".webm\",\n        \".m4v\"\n    ],\n    documents: [\n        \".pdf\",\n        \".doc\",\n        \".docx\",\n        \".txt\",\n        \".rtf\"\n    ],\n    audio: [\n        \".mp3\",\n        \".wav\",\n        \".aac\",\n        \".ogg\",\n        \".flac\"\n    ],\n    archives: [\n        \".zip\",\n        \".rar\",\n        \".7z\",\n        \".tar\",\n        \".gz\"\n    ]\n};\n// MIME type tekshiruvi\nconst ALLOWED_MIME_TYPES = [\n    // Rasm fayllari\n    \"image/jpeg\",\n    \"image/png\",\n    \"image/gif\",\n    \"image/webp\",\n    \"image/svg+xml\",\n    \"image/bmp\",\n    \"image/tiff\",\n    // Video fayllar\n    \"video/mp4\",\n    \"video/avi\",\n    \"video/quicktime\",\n    \"video/x-msvideo\",\n    \"video/x-ms-wmv\",\n    \"video/x-flv\",\n    \"video/webm\",\n    // Hujjat fayllari\n    \"application/pdf\",\n    \"application/msword\",\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\",\n    \"text/plain\",\n    \"application/rtf\",\n    // Audio fayllar\n    \"audio/mpeg\",\n    \"audio/wav\",\n    \"audio/aac\",\n    \"audio/ogg\",\n    \"audio/flac\",\n    // Arxiv fayllari\n    \"application/zip\",\n    \"application/x-rar-compressed\",\n    \"application/x-7z-compressed\",\n    \"application/x-tar\",\n    \"application/gzip\"\n];\n// Fayl o'lchamini tekshirish (10MB limit - Supabase uchun)\nconst MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB\n// Xavfli fayllarni tekshirish\nconst DANGEROUS_EXTENSIONS = [\n    \".exe\",\n    \".bat\",\n    \".cmd\",\n    \".scr\",\n    \".pif\",\n    \".com\",\n    \".js\",\n    \".vbs\",\n    \".jar\"\n];\nfunction isFileTypeAllowed(filename, mimetype) {\n    const extension = path__WEBPACK_IMPORTED_MODULE_3___default().extname(filename).toLowerCase();\n    // Xavfli fayllarni rad etish\n    if (DANGEROUS_EXTENSIONS.includes(extension)) {\n        return false;\n    }\n    // Ruxsat berilgan kengaytmalarni tekshirish\n    const allAllowedExtensions = Object.values(ALLOWED_FILE_TYPES).flat();\n    const isExtensionAllowed = allAllowedExtensions.includes(extension);\n    // MIME type tekshiruvi\n    const isMimeTypeAllowed = ALLOWED_MIME_TYPES.includes(mimetype);\n    return isExtensionAllowed && isMimeTypeAllowed;\n}\nfunction sanitizeFilename(filename) {\n    // Xavfli belgilarni olib tashlash\n    return filename.replace(/[^a-zA-Z0-9\\-_\\.]/g, \"_\");\n}\n// Supabase bucket yaratish (agar mavjud bo'lmasa)\nasync function ensureBucketExists() {\n    try {\n        const { data: buckets, error } = await supabase.storage.listBuckets();\n        if (error) {\n            console.error(\"Bucket list error:\", error);\n            return false;\n        }\n        const bucketExists = buckets.some((bucket)=>bucket.name === BUCKET_NAME);\n        if (!bucketExists) {\n            const { error: createError } = await supabase.storage.createBucket(BUCKET_NAME, {\n                public: true,\n                allowedMimeTypes: ALLOWED_MIME_TYPES,\n                fileSizeLimit: MAX_FILE_SIZE\n            });\n            if (createError) {\n                console.error(\"Bucket create error:\", createError);\n                return false;\n            }\n            console.log(`Bucket \"${BUCKET_NAME}\" yaratildi`);\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Bucket ensure error:\", error);\n        return false;\n    }\n}\n// Bitta faylni yuklash funksiyasi\nasync function uploadSingleFile(fileArray, type, username, postIndex) {\n    const originalName = fileArray.originalFilename || \"unknown\";\n    const mimetype = fileArray.mimetype;\n    const fileSize = fileArray.size;\n    // Fayl turini tekshirish\n    if (!isFileTypeAllowed(originalName, mimetype)) {\n        // Vaqtinchalik faylni o'chirish\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(fileArray.filepath)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(fileArray.filepath);\n        }\n        return {\n            success: false,\n            error: \"Ushbu fayl turi ruxsat berilmagan\",\n            filename: originalName\n        };\n    }\n    // Fayl o'lchamini qo'shimcha tekshirish\n    if (fileSize > MAX_FILE_SIZE) {\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(fileArray.filepath)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(fileArray.filepath);\n        }\n        return {\n            success: false,\n            error: \"Fayl hajmi juda katta (maksimum 10MB)\",\n            filename: originalName\n        };\n    }\n    try {\n        // Fayl nomini xavfsiz qilish\n        const safeOriginalName = sanitizeFilename(originalName);\n        const fileExtension = path__WEBPACK_IMPORTED_MODULE_3___default().extname(safeOriginalName);\n        // Noyob fayl nomi yaratish\n        const timestamp = Date.now();\n        const randomString = Math.random().toString(36).substring(2, 8);\n        let fileName;\n        let folderPath;\n        if (type === \"profile\") {\n            folderPath = \"profiles\";\n            fileName = `${username}_${timestamp}_${randomString}${fileExtension}`;\n        } else {\n            folderPath = \"posts\";\n            fileName = `${username}_${postIndex}_${timestamp}_${randomString}${fileExtension}`;\n        }\n        // To'liq fayl yo'li\n        const filePath = `${folderPath}/${fileName}`;\n        // Faylni o'qish\n        const fileBuffer = fs__WEBPACK_IMPORTED_MODULE_2___default().readFileSync(fileArray.filepath);\n        // Supabase Storage ga yuklash\n        const { data: uploadData, error: uploadError } = await supabase.storage.from(BUCKET_NAME).upload(filePath, fileBuffer, {\n            contentType: mimetype,\n            upsert: false\n        });\n        // Vaqtinchalik faylni o'chirish\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(fileArray.filepath)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(fileArray.filepath);\n        }\n        if (uploadError) {\n            console.error(\"Supabase upload error:\", uploadError);\n            return {\n                success: false,\n                error: \"Faylni saqlashda xatolik\",\n                filename: originalName,\n                details: uploadError.message\n            };\n        }\n        // Public URL olish\n        const { data: urlData } = supabase.storage.from(BUCKET_NAME).getPublicUrl(filePath);\n        return {\n            success: true,\n            url: urlData.publicUrl,\n            filename: fileName,\n            originalName: originalName,\n            fileSize: fileSize,\n            mimeType: mimetype,\n            path: filePath,\n            bucket: BUCKET_NAME\n        };\n    } catch (fileError) {\n        console.error(\"File processing error:\", fileError);\n        // Vaqtinchalik faylni o'chirish\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(fileArray.filepath)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().unlinkSync(fileArray.filepath);\n        }\n        return {\n            success: false,\n            error: \"Faylni qayta ishlashda xatolik\",\n            filename: originalName\n        };\n    }\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        // Bucket mavjudligini tekshirish\n        const bucketReady = await ensureBucketExists();\n        if (!bucketReady) {\n            return res.status(500).json({\n                error: \"Storage bucket tayyorlanmadi\"\n            });\n        }\n        const form = new formidable__WEBPACK_IMPORTED_MODULE_0__.IncomingForm({\n            maxFileSize: MAX_FILE_SIZE,\n            maxFiles: 10,\n            allowEmptyFiles: false,\n            minFileSize: 1,\n            multiples: true\n        });\n        form.parse(req, async (err, fields, files)=>{\n            if (err) {\n                console.error(\"Form parse error:\", err);\n                if (err.code === \"LIMIT_FILE_SIZE\") {\n                    return res.status(413).json({\n                        error: \"Fayl hajmi juda katta (maksimum 10MB)\"\n                    });\n                }\n                return res.status(500).json({\n                    error: \"Yuklashda xatolik yuz berdi\"\n                });\n            }\n            // Maydonlardan ma'lumotlarni olish\n            const type = Array.isArray(fields.type) ? fields.type[0] : fields.type;\n            const username = Array.isArray(fields.username) ? fields.username[0] : fields.username;\n            const postIndex = Array.isArray(fields.postIndex) ? fields.postIndex[0] : fields.postIndex;\n            // Fayllar massivini olish\n            const fileArray = files.file;\n            if (!fileArray || Array.isArray(fileArray) && fileArray.length === 0) {\n                return res.status(400).json({\n                    error: \"Hech qanday fayl yuklanmadi\"\n                });\n            }\n            // Barcha fayllarni bir vaqtda yuklash (parallel)\n            const uploadPromises = [];\n            // Fayllar massiv ekanligini tekshirish\n            const filesToProcess = Array.isArray(fileArray) ? fileArray : [\n                fileArray\n            ];\n            console.log(`Jami ${filesToProcess.length} ta fayl yuklanmoqda...`);\n            filesToProcess.forEach((file, index)=>{\n                if (file && file.filepath) {\n                    uploadPromises.push(uploadSingleFile(file, type, username, postIndex).then((result)=>({\n                            ...result,\n                            order: index // Tartib raqamini saqlash\n                        })));\n                }\n            });\n            try {\n                // Barcha yuklashlarni kutish\n                const results = await Promise.allSettled(uploadPromises);\n                // Natijalarni qayta ishlash\n                const successfulUploads = [];\n                const failedUploads = [];\n                results.forEach((result, index)=>{\n                    if (result.status === \"fulfilled\") {\n                        if (result.value.success) {\n                            successfulUploads.push(result.value);\n                        } else {\n                            failedUploads.push({\n                                ...result.value,\n                                order: index\n                            });\n                        }\n                    } else {\n                        failedUploads.push({\n                            success: false,\n                            error: \"Noma'lum xatolik\",\n                            order: index\n                        });\n                    }\n                });\n                // Javob tayyorlash\n                const response = {\n                    success: successfulUploads.length > 0,\n                    totalFiles: filesToProcess.length,\n                    successful: successfulUploads.length,\n                    failed: failedUploads.length,\n                    uploads: successfulUploads,\n                    errors: failedUploads\n                };\n                // Agar barcha fayllar muvaffaqiyatli yuklangan bo'lsa\n                if (failedUploads.length === 0) {\n                    res.status(200).json({\n                        ...response,\n                        message: `${successfulUploads.length} ta fayl muvaffaqiyatli yuklandi`\n                    });\n                } else if (successfulUploads.length === 0) {\n                    // Agar hech qaysi fayl yuklanmagan bo'lsa\n                    res.status(400).json({\n                        ...response,\n                        message: \"Hech qanday fayl yuklanmadi\"\n                    });\n                } else {\n                    // Qisman muvaffaqiyatli\n                    res.status(207).json({\n                        ...response,\n                        message: `${successfulUploads.length} ta fayl yuklandi, ${failedUploads.length} ta faylda xatolik`\n                    });\n                }\n            } catch (batchError) {\n                console.error(\"Batch upload error:\", batchError);\n                res.status(500).json({\n                    error: \"Fayllarni yuklashda xatolik\",\n                    details: batchError.message\n                });\n            }\n        });\n    } catch (error) {\n        console.error(\"Upload error:\", error);\n        res.status(500).json({\n            error: \"Ichki server xatoligi\"\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q25CLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQ25CLEdBQUcrQixRQUFRO3dCQUNYM0MsU0FBUztvQkFDWDtnQkFDRixPQUFPO29CQUNMLHdCQUF3QjtvQkFDeEJTLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7d0JBQ25CLEdBQUcrQixRQUFRO3dCQUNYM0MsU0FBUyxDQUFDLEVBQUV3QyxrQkFBa0JaLE1BQU0sQ0FBQyxtQkFBbUIsRUFBRWEsY0FBY2IsTUFBTSxDQUFDLGtCQUFrQixDQUFDO29CQUNwRztnQkFDRjtZQUVGLEVBQUUsT0FBT3FCLFlBQVk7Z0JBQ25CL0YsUUFBUUgsS0FBSyxDQUFDLHVCQUF1QmtHO2dCQUNyQ3hDLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7b0JBQ25CN0QsT0FBTztvQkFDUGdELFNBQVNrRCxXQUFXakQsT0FBTztnQkFDN0I7WUFDRjtRQUNGO0lBRUYsRUFBRSxPQUFPakQsT0FBTztRQUNkRyxRQUFRSCxLQUFLLENBQUMsaUJBQWlCQTtRQUMvQjBELElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRTdELE9BQU87UUFBd0I7SUFDeEQ7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3ByaXZhdGUvLi9wYWdlcy9hcGkvdXBsb2FkLmpzPzU1NzIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5jb21pbmdGb3JtIH0gZnJvbSAnZm9ybWlkYWJsZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICBhcGk6IHtcclxuICAgIGJvZHlQYXJzZXI6IGZhbHNlLFxyXG4gIH0sXHJcbn07XHJcblxyXG4vLyBTdXBhYmFzZSBrb25maWd1cmF0c2l5YXNpXHJcbmNvbnN0IHN1cGFiYXNlVXJsID0gXCJodHRwczovL3h6Yndmb2Fjc25ybWdqbWlsZGNyLnN1cGFiYXNlLmNvXCI7XHJcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IFwiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW5oNlluZG1iMkZqYzI1eWJXZHFiV2xzWkdOeUlpd2ljbTlzWlNJNkluTmxjblpwWTJWZmNtOXNaU0lzSW1saGRDSTZNVGMxT0RFNU9URTNOU3dpWlhod0lqb3lNRGN6TnpjMU1UYzFmUS50MHU4VXk3RDdOM0tXZ050aEZUaWpoQ3VjTjRWY0ZjMzlRQVBBd0RZWGZvXCI7XHJcbmNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXkpO1xyXG5cclxuLy8gQnVja2V0IG5vbWlcclxuY29uc3QgQlVDS0VUX05BTUUgPSAndXBsb2Fkcyc7XHJcblxyXG4vLyBSdXhzYXQgYmVyaWxnYW4gZmlsZSB0dXJsYXJpXHJcbmNvbnN0IEFMTE9XRURfRklMRV9UWVBFUyA9IHtcclxuICBpbWFnZXM6IFsnLmpwZycsICcuanBlZycsICcucG5nJywgJy5naWYnLCAnLndlYnAnLCAnLnN2ZycsICcuYm1wJywgJy50aWZmJ10sXHJcbiAgdmlkZW9zOiBbJy5tcDQnLCAnLmF2aScsICcubWt2JywgJy5tb3YnLCAnLndtdicsICcuZmx2JywgJy53ZWJtJywgJy5tNHYnXSxcclxuICBkb2N1bWVudHM6IFsnLnBkZicsICcuZG9jJywgJy5kb2N4JywgJy50eHQnLCAnLnJ0ZiddLFxyXG4gIGF1ZGlvOiBbJy5tcDMnLCAnLndhdicsICcuYWFjJywgJy5vZ2cnLCAnLmZsYWMnXSxcclxuICBhcmNoaXZlczogWycuemlwJywgJy5yYXInLCAnLjd6JywgJy50YXInLCAnLmd6J11cclxufTtcclxuXHJcbi8vIE1JTUUgdHlwZSB0ZWtzaGlydXZpXHJcbmNvbnN0IEFMTE9XRURfTUlNRV9UWVBFUyA9IFtcclxuICAvLyBSYXNtIGZheWxsYXJpXHJcbiAgJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL2dpZicsICdpbWFnZS93ZWJwJywgJ2ltYWdlL3N2Zyt4bWwnLCBcclxuICAnaW1hZ2UvYm1wJywgJ2ltYWdlL3RpZmYnLFxyXG4gIFxyXG4gIC8vIFZpZGVvIGZheWxsYXJcclxuICAndmlkZW8vbXA0JywgJ3ZpZGVvL2F2aScsICd2aWRlby9xdWlja3RpbWUnLCAndmlkZW8veC1tc3ZpZGVvJyxcclxuICAndmlkZW8veC1tcy13bXYnLCAndmlkZW8veC1mbHYnLCAndmlkZW8vd2VibScsXHJcbiAgXHJcbiAgLy8gSHVqamF0IGZheWxsYXJpXHJcbiAgJ2FwcGxpY2F0aW9uL3BkZicsICdhcHBsaWNhdGlvbi9tc3dvcmQnLCBcclxuICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLFxyXG4gICd0ZXh0L3BsYWluJywgJ2FwcGxpY2F0aW9uL3J0ZicsXHJcbiAgXHJcbiAgLy8gQXVkaW8gZmF5bGxhclxyXG4gICdhdWRpby9tcGVnJywgJ2F1ZGlvL3dhdicsICdhdWRpby9hYWMnLCAnYXVkaW8vb2dnJywgJ2F1ZGlvL2ZsYWMnLFxyXG4gIFxyXG4gIC8vIEFyeGl2IGZheWxsYXJpXHJcbiAgJ2FwcGxpY2F0aW9uL3ppcCcsICdhcHBsaWNhdGlvbi94LXJhci1jb21wcmVzc2VkJywgJ2FwcGxpY2F0aW9uL3gtN3otY29tcHJlc3NlZCcsXHJcbiAgJ2FwcGxpY2F0aW9uL3gtdGFyJywgJ2FwcGxpY2F0aW9uL2d6aXAnXHJcbl07XHJcblxyXG4vLyBGYXlsIG8nbGNoYW1pbmkgdGVrc2hpcmlzaCAoMTBNQiBsaW1pdCAtIFN1cGFiYXNlIHVjaHVuKVxyXG5jb25zdCBNQVhfRklMRV9TSVpFID0gMTAgKiAxMDI0ICogMTAyNDsgLy8gMTBNQlxyXG5cclxuLy8gWGF2ZmxpIGZheWxsYXJuaSB0ZWtzaGlyaXNoXHJcbmNvbnN0IERBTkdFUk9VU19FWFRFTlNJT05TID0gWycuZXhlJywgJy5iYXQnLCAnLmNtZCcsICcuc2NyJywgJy5waWYnLCAnLmNvbScsICcuanMnLCAnLnZicycsICcuamFyJ107XHJcblxyXG5mdW5jdGlvbiBpc0ZpbGVUeXBlQWxsb3dlZChmaWxlbmFtZSwgbWltZXR5cGUpIHtcclxuICBjb25zdCBleHRlbnNpb24gPSBwYXRoLmV4dG5hbWUoZmlsZW5hbWUpLnRvTG93ZXJDYXNlKCk7XHJcbiAgXHJcbiAgLy8gWGF2ZmxpIGZheWxsYXJuaSByYWQgZXRpc2hcclxuICBpZiAoREFOR0VST1VTX0VYVEVOU0lPTlMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBcclxuICAvLyBSdXhzYXQgYmVyaWxnYW4ga2VuZ2F5dG1hbGFybmkgdGVrc2hpcmlzaFxyXG4gIGNvbnN0IGFsbEFsbG93ZWRFeHRlbnNpb25zID0gT2JqZWN0LnZhbHVlcyhBTExPV0VEX0ZJTEVfVFlQRVMpLmZsYXQoKTtcclxuICBjb25zdCBpc0V4dGVuc2lvbkFsbG93ZWQgPSBhbGxBbGxvd2VkRXh0ZW5zaW9ucy5pbmNsdWRlcyhleHRlbnNpb24pO1xyXG4gIFxyXG4gIC8vIE1JTUUgdHlwZSB0ZWtzaGlydXZpXHJcbiAgY29uc3QgaXNNaW1lVHlwZUFsbG93ZWQgPSBBTExPV0VEX01JTUVfVFlQRVMuaW5jbHVkZXMobWltZXR5cGUpO1xyXG4gIFxyXG4gIHJldHVybiBpc0V4dGVuc2lvbkFsbG93ZWQgJiYgaXNNaW1lVHlwZUFsbG93ZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNhbml0aXplRmlsZW5hbWUoZmlsZW5hbWUpIHtcclxuICAvLyBYYXZmbGkgYmVsZ2lsYXJuaSBvbGliIHRhc2hsYXNoXHJcbiAgcmV0dXJuIGZpbGVuYW1lLnJlcGxhY2UoL1teYS16QS1aMC05XFwtX1xcLl0vZywgJ18nKTtcclxufVxyXG5cclxuLy8gU3VwYWJhc2UgYnVja2V0IHlhcmF0aXNoIChhZ2FyIG1hdmp1ZCBibydsbWFzYSlcclxuYXN5bmMgZnVuY3Rpb24gZW5zdXJlQnVja2V0RXhpc3RzKCkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB7IGRhdGE6IGJ1Y2tldHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5zdG9yYWdlLmxpc3RCdWNrZXRzKCk7XHJcbiAgICBcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdCdWNrZXQgbGlzdCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgYnVja2V0RXhpc3RzID0gYnVja2V0cy5zb21lKGJ1Y2tldCA9PiBidWNrZXQubmFtZSA9PT0gQlVDS0VUX05BTUUpO1xyXG4gICAgXHJcbiAgICBpZiAoIWJ1Y2tldEV4aXN0cykge1xyXG4gICAgICBjb25zdCB7IGVycm9yOiBjcmVhdGVFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZS5jcmVhdGVCdWNrZXQoQlVDS0VUX05BTUUsIHtcclxuICAgICAgICBwdWJsaWM6IHRydWUsXHJcbiAgICAgICAgYWxsb3dlZE1pbWVUeXBlczogQUxMT1dFRF9NSU1FX1RZUEVTLFxyXG4gICAgICAgIGZpbGVTaXplTGltaXQ6IE1BWF9GSUxFX1NJWkVcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoY3JlYXRlRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdCdWNrZXQgY3JlYXRlIGVycm9yOicsIGNyZWF0ZUVycm9yKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKGBCdWNrZXQgXCIke0JVQ0tFVF9OQU1FfVwiIHlhcmF0aWxkaWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignQnVja2V0IGVuc3VyZSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBCaXR0YSBmYXlsbmkgeXVrbGFzaCBmdW5rc2l5YXNpXHJcbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZFNpbmdsZUZpbGUoZmlsZUFycmF5LCB0eXBlLCB1c2VybmFtZSwgcG9zdEluZGV4KSB7XHJcbiAgY29uc3Qgb3JpZ2luYWxOYW1lID0gZmlsZUFycmF5Lm9yaWdpbmFsRmlsZW5hbWUgfHwgJ3Vua25vd24nO1xyXG4gIGNvbnN0IG1pbWV0eXBlID0gZmlsZUFycmF5Lm1pbWV0eXBlO1xyXG4gIGNvbnN0IGZpbGVTaXplID0gZmlsZUFycmF5LnNpemU7XHJcblxyXG4gIC8vIEZheWwgdHVyaW5pIHRla3NoaXJpc2hcclxuICBpZiAoIWlzRmlsZVR5cGVBbGxvd2VkKG9yaWdpbmFsTmFtZSwgbWltZXR5cGUpKSB7XHJcbiAgICAvLyBWYXF0aW5jaGFsaWsgZmF5bG5pIG8nY2hpcmlzaFxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZUFycmF5LmZpbGVwYXRoKSkge1xyXG4gICAgICBmcy51bmxpbmtTeW5jKGZpbGVBcnJheS5maWxlcGF0aCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdVc2hidSBmYXlsIHR1cmkgcnV4c2F0IGJlcmlsbWFnYW4nLFxyXG4gICAgICBmaWxlbmFtZTogb3JpZ2luYWxOYW1lXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLy8gRmF5bCBvJ2xjaGFtaW5pIHFvJ3NoaW1jaGEgdGVrc2hpcmlzaFxyXG4gIGlmIChmaWxlU2l6ZSA+IE1BWF9GSUxFX1NJWkUpIHtcclxuICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVBcnJheS5maWxlcGF0aCkpIHtcclxuICAgICAgZnMudW5saW5rU3luYyhmaWxlQXJyYXkuZmlsZXBhdGgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRmF5bCBoYWptaSBqdWRhIGthdHRhIChtYWtzaW11bSAxME1CKScsXHJcbiAgICAgIGZpbGVuYW1lOiBvcmlnaW5hbE5hbWVcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICB0cnkge1xyXG4gICAgLy8gRmF5bCBub21pbmkgeGF2ZnNpeiBxaWxpc2hcclxuICAgIGNvbnN0IHNhZmVPcmlnaW5hbE5hbWUgPSBzYW5pdGl6ZUZpbGVuYW1lKG9yaWdpbmFsTmFtZSk7XHJcbiAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKHNhZmVPcmlnaW5hbE5hbWUpO1xyXG5cclxuICAgIC8vIE5veW9iIGZheWwgbm9taSB5YXJhdGlzaFxyXG4gICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcclxuICAgIGNvbnN0IHJhbmRvbVN0cmluZyA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCA4KTtcclxuICAgIFxyXG4gICAgbGV0IGZpbGVOYW1lO1xyXG4gICAgbGV0IGZvbGRlclBhdGg7XHJcbiAgICBcclxuICAgIGlmICh0eXBlID09PSAncHJvZmlsZScpIHtcclxuICAgICAgZm9sZGVyUGF0aCA9ICdwcm9maWxlcyc7XHJcbiAgICAgIGZpbGVOYW1lID0gYCR7dXNlcm5hbWV9XyR7dGltZXN0YW1wfV8ke3JhbmRvbVN0cmluZ30ke2ZpbGVFeHRlbnNpb259YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZvbGRlclBhdGggPSAncG9zdHMnO1xyXG4gICAgICBmaWxlTmFtZSA9IGAke3VzZXJuYW1lfV8ke3Bvc3RJbmRleH1fJHt0aW1lc3RhbXB9XyR7cmFuZG9tU3RyaW5nfSR7ZmlsZUV4dGVuc2lvbn1gO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRvJ2xpcSBmYXlsIHlvJ2xpXHJcbiAgICBjb25zdCBmaWxlUGF0aCA9IGAke2ZvbGRlclBhdGh9LyR7ZmlsZU5hbWV9YDtcclxuXHJcbiAgICAvLyBGYXlsbmkgbydxaXNoXHJcbiAgICBjb25zdCBmaWxlQnVmZmVyID0gZnMucmVhZEZpbGVTeW5jKGZpbGVBcnJheS5maWxlcGF0aCk7XHJcblxyXG4gICAgLy8gU3VwYWJhc2UgU3RvcmFnZSBnYSB5dWtsYXNoXHJcbiAgICBjb25zdCB7IGRhdGE6IHVwbG9hZERhdGEsIGVycm9yOiB1cGxvYWRFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxyXG4gICAgICAuZnJvbShCVUNLRVRfTkFNRSlcclxuICAgICAgLnVwbG9hZChmaWxlUGF0aCwgZmlsZUJ1ZmZlciwge1xyXG4gICAgICAgIGNvbnRlbnRUeXBlOiBtaW1ldHlwZSxcclxuICAgICAgICB1cHNlcnQ6IGZhbHNlLFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAvLyBWYXF0aW5jaGFsaWsgZmF5bG5pIG8nY2hpcmlzaFxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZUFycmF5LmZpbGVwYXRoKSkge1xyXG4gICAgICBmcy51bmxpbmtTeW5jKGZpbGVBcnJheS5maWxlcGF0aCk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHVwbG9hZEVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1cGFiYXNlIHVwbG9hZCBlcnJvcjonLCB1cGxvYWRFcnJvcik7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgZXJyb3I6ICdGYXlsbmkgc2FxbGFzaGRhIHhhdG9saWsnLFxyXG4gICAgICAgIGZpbGVuYW1lOiBvcmlnaW5hbE5hbWUsXHJcbiAgICAgICAgZGV0YWlsczogdXBsb2FkRXJyb3IubWVzc2FnZVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFB1YmxpYyBVUkwgb2xpc2hcclxuICAgIGNvbnN0IHsgZGF0YTogdXJsRGF0YSB9ID0gc3VwYWJhc2Uuc3RvcmFnZVxyXG4gICAgICAuZnJvbShCVUNLRVRfTkFNRSlcclxuICAgICAgLmdldFB1YmxpY1VybChmaWxlUGF0aCk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgdXJsOiB1cmxEYXRhLnB1YmxpY1VybCxcclxuICAgICAgZmlsZW5hbWU6IGZpbGVOYW1lLFxyXG4gICAgICBvcmlnaW5hbE5hbWU6IG9yaWdpbmFsTmFtZSxcclxuICAgICAgZmlsZVNpemU6IGZpbGVTaXplLFxyXG4gICAgICBtaW1lVHlwZTogbWltZXR5cGUsXHJcbiAgICAgIHBhdGg6IGZpbGVQYXRoLFxyXG4gICAgICBidWNrZXQ6IEJVQ0tFVF9OQU1FXHJcbiAgICB9O1xyXG5cclxuICB9IGNhdGNoIChmaWxlRXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbGUgcHJvY2Vzc2luZyBlcnJvcjonLCBmaWxlRXJyb3IpO1xyXG4gICAgXHJcbiAgICAvLyBWYXF0aW5jaGFsaWsgZmF5bG5pIG8nY2hpcmlzaFxyXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMoZmlsZUFycmF5LmZpbGVwYXRoKSkge1xyXG4gICAgICBmcy51bmxpbmtTeW5jKGZpbGVBcnJheS5maWxlcGF0aCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBlcnJvcjogJ0ZheWxuaSBxYXl0YSBpc2hsYXNoZGEgeGF0b2xpaycsXHJcbiAgICAgIGZpbGVuYW1lOiBvcmlnaW5hbE5hbWVcclxuICAgIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XHJcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5qc29uKHsgZXJyb3I6ICdNZXRob2Qgbm90IGFsbG93ZWQnIH0pO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIC8vIEJ1Y2tldCBtYXZqdWRsaWdpbmkgdGVrc2hpcmlzaFxyXG4gICAgY29uc3QgYnVja2V0UmVhZHkgPSBhd2FpdCBlbnN1cmVCdWNrZXRFeGlzdHMoKTtcclxuICAgIGlmICghYnVja2V0UmVhZHkpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdTdG9yYWdlIGJ1Y2tldCB0YXl5b3JsYW5tYWRpJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBmb3JtID0gbmV3IEluY29taW5nRm9ybSh7XHJcbiAgICAgIG1heEZpbGVTaXplOiBNQVhfRklMRV9TSVpFLFxyXG4gICAgICBtYXhGaWxlczogMTAsIC8vIE1ha3NpbXVtIDEwIHRhIGZheWxcclxuICAgICAgYWxsb3dFbXB0eUZpbGVzOiBmYWxzZSxcclxuICAgICAgbWluRmlsZVNpemU6IDEsXHJcbiAgICAgIG11bHRpcGxlczogdHJ1ZSwgLy8gS28ncCBmYXlsbGFybmkgcW8nbGxhYi1xdXZ2YXRsYXNoXHJcbiAgICB9KTtcclxuXHJcbiAgICBmb3JtLnBhcnNlKHJlcSwgYXN5bmMgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xyXG4gICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRm9ybSBwYXJzZSBlcnJvcjonLCBlcnIpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChlcnIuY29kZSA9PT0gJ0xJTUlUX0ZJTEVfU0laRScpIHtcclxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQxMykuanNvbih7IFxyXG4gICAgICAgICAgICBlcnJvcjogJ0ZheWwgaGFqbWkganVkYSBrYXR0YSAobWFrc2ltdW0gMTBNQiknIFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiAnWXVrbGFzaGRhIHhhdG9saWsgeXV6IGJlcmRpJyB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gTWF5ZG9ubGFyZGFuIG1hJ2x1bW90bGFybmkgb2xpc2hcclxuICAgICAgY29uc3QgdHlwZSA9IEFycmF5LmlzQXJyYXkoZmllbGRzLnR5cGUpID8gZmllbGRzLnR5cGVbMF0gOiBmaWVsZHMudHlwZTtcclxuICAgICAgY29uc3QgdXNlcm5hbWUgPSBBcnJheS5pc0FycmF5KGZpZWxkcy51c2VybmFtZSkgPyBmaWVsZHMudXNlcm5hbWVbMF0gOiBmaWVsZHMudXNlcm5hbWU7XHJcbiAgICAgIGNvbnN0IHBvc3RJbmRleCA9IEFycmF5LmlzQXJyYXkoZmllbGRzLnBvc3RJbmRleCkgPyBmaWVsZHMucG9zdEluZGV4WzBdIDogZmllbGRzLnBvc3RJbmRleDtcclxuXHJcbiAgICAgIC8vIEZheWxsYXIgbWFzc2l2aW5pIG9saXNoXHJcbiAgICAgIGNvbnN0IGZpbGVBcnJheSA9IGZpbGVzLmZpbGU7XHJcbiAgICAgIGlmICghZmlsZUFycmF5IHx8IChBcnJheS5pc0FycmF5KGZpbGVBcnJheSkgJiYgZmlsZUFycmF5Lmxlbmd0aCA9PT0gMCkpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0hlY2ggcWFuZGF5IGZheWwgeXVrbGFubWFkaScgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEJhcmNoYSBmYXlsbGFybmkgYmlyIHZhcXRkYSB5dWtsYXNoIChwYXJhbGxlbClcclxuICAgICAgY29uc3QgdXBsb2FkUHJvbWlzZXMgPSBbXTtcclxuICAgICAgXHJcbiAgICAgIC8vIEZheWxsYXIgbWFzc2l2IGVrYW5saWdpbmkgdGVrc2hpcmlzaFxyXG4gICAgICBjb25zdCBmaWxlc1RvUHJvY2VzcyA9IEFycmF5LmlzQXJyYXkoZmlsZUFycmF5KSA/IGZpbGVBcnJheSA6IFtmaWxlQXJyYXldO1xyXG4gICAgICBcclxuICAgICAgY29uc29sZS5sb2coYEphbWkgJHtmaWxlc1RvUHJvY2Vzcy5sZW5ndGh9IHRhIGZheWwgeXVrbGFubW9xZGEuLi5gKTtcclxuICAgICAgXHJcbiAgICAgIGZpbGVzVG9Qcm9jZXNzLmZvckVhY2goKGZpbGUsIGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYgKGZpbGUgJiYgZmlsZS5maWxlcGF0aCkge1xyXG4gICAgICAgICAgdXBsb2FkUHJvbWlzZXMucHVzaChcclxuICAgICAgICAgICAgdXBsb2FkU2luZ2xlRmlsZShmaWxlLCB0eXBlLCB1c2VybmFtZSwgcG9zdEluZGV4KS50aGVuKHJlc3VsdCA9PiAoe1xyXG4gICAgICAgICAgICAgIC4uLnJlc3VsdCxcclxuICAgICAgICAgICAgICBvcmRlcjogaW5kZXggLy8gVGFydGliIHJhcWFtaW5pIHNhcWxhc2hcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIEJhcmNoYSB5dWtsYXNobGFybmkga3V0aXNoXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZCh1cGxvYWRQcm9taXNlcyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTmF0aWphbGFybmkgcWF5dGEgaXNobGFzaFxyXG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NmdWxVcGxvYWRzID0gW107XHJcbiAgICAgICAgY29uc3QgZmFpbGVkVXBsb2FkcyA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0LCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09ICdmdWxmaWxsZWQnKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQudmFsdWUuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgIHN1Y2Nlc3NmdWxVcGxvYWRzLnB1c2gocmVzdWx0LnZhbHVlKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBmYWlsZWRVcGxvYWRzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgLi4ucmVzdWx0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgb3JkZXI6IGluZGV4XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZhaWxlZFVwbG9hZHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgZXJyb3I6ICdOb21hXFwnbHVtIHhhdG9saWsnLFxyXG4gICAgICAgICAgICAgIG9yZGVyOiBpbmRleFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gSmF2b2IgdGF5eW9ybGFzaFxyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgc3VjY2Vzczogc3VjY2Vzc2Z1bFVwbG9hZHMubGVuZ3RoID4gMCxcclxuICAgICAgICAgIHRvdGFsRmlsZXM6IGZpbGVzVG9Qcm9jZXNzLmxlbmd0aCxcclxuICAgICAgICAgIHN1Y2Nlc3NmdWw6IHN1Y2Nlc3NmdWxVcGxvYWRzLmxlbmd0aCxcclxuICAgICAgICAgIGZhaWxlZDogZmFpbGVkVXBsb2Fkcy5sZW5ndGgsXHJcbiAgICAgICAgICB1cGxvYWRzOiBzdWNjZXNzZnVsVXBsb2FkcyxcclxuICAgICAgICAgIGVycm9yczogZmFpbGVkVXBsb2Fkc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIEFnYXIgYmFyY2hhIGZheWxsYXIgbXV2YWZmYXFpeWF0bGkgeXVrbGFuZ2FuIGJvJ2xzYVxyXG4gICAgICAgIGlmIChmYWlsZWRVcGxvYWRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4gICAgICAgICAgICAuLi5yZXNwb25zZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogYCR7c3VjY2Vzc2Z1bFVwbG9hZHMubGVuZ3RofSB0YSBmYXlsIG11dmFmZmFxaXlhdGxpIHl1a2xhbmRpYFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChzdWNjZXNzZnVsVXBsb2Fkcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgIC8vIEFnYXIgaGVjaCBxYXlzaSBmYXlsIHl1a2xhbm1hZ2FuIGJvJ2xzYVxyXG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgICAuLi5yZXNwb25zZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0hlY2ggcWFuZGF5IGZheWwgeXVrbGFubWFkaSdcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAvLyBRaXNtYW4gbXV2YWZmYXFpeWF0bGlcclxuICAgICAgICAgIHJlcy5zdGF0dXMoMjA3KS5qc29uKHtcclxuICAgICAgICAgICAgLi4ucmVzcG9uc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGAke3N1Y2Nlc3NmdWxVcGxvYWRzLmxlbmd0aH0gdGEgZmF5bCB5dWtsYW5kaSwgJHtmYWlsZWRVcGxvYWRzLmxlbmd0aH0gdGEgZmF5bGRhIHhhdG9saWtgXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9IGNhdGNoIChiYXRjaEVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignQmF0Y2ggdXBsb2FkIGVycm9yOicsIGJhdGNoRXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXHJcbiAgICAgICAgICBlcnJvcjogJ0ZheWxsYXJuaSB5dWtsYXNoZGEgeGF0b2xpaycsXHJcbiAgICAgICAgICBkZXRhaWxzOiBiYXRjaEVycm9yLm1lc3NhZ2UgXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignVXBsb2FkIGVycm9yOicsIGVycm9yKTtcclxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJY2hraSBzZXJ2ZXIgeGF0b2xpZ2knIH0pO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJJbmNvbWluZ0Zvcm0iLCJjcmVhdGVDbGllbnQiLCJmcyIsInBhdGgiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwic3VwYWJhc2VVcmwiLCJzdXBhYmFzZVNlcnZpY2VLZXkiLCJzdXBhYmFzZSIsIkJVQ0tFVF9OQU1FIiwiQUxMT1dFRF9GSUxFX1RZUEVTIiwiaW1hZ2VzIiwidmlkZW9zIiwiZG9jdW1lbnRzIiwiYXVkaW8iLCJhcmNoaXZlcyIsIkFMTE9XRURfTUlNRV9UWVBFUyIsIk1BWF9GSUxFX1NJWkUiLCJEQU5HRVJPVVNfRVhURU5TSU9OUyIsImlzRmlsZVR5cGVBbGxvd2VkIiwiZmlsZW5hbWUiLCJtaW1ldHlwZSIsImV4dGVuc2lvbiIsImV4dG5hbWUiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiYWxsQWxsb3dlZEV4dGVuc2lvbnMiLCJPYmplY3QiLCJ2YWx1ZXMiLCJmbGF0IiwiaXNFeHRlbnNpb25BbGxvd2VkIiwiaXNNaW1lVHlwZUFsbG93ZWQiLCJzYW5pdGl6ZUZpbGVuYW1lIiwicmVwbGFjZSIsImVuc3VyZUJ1Y2tldEV4aXN0cyIsImRhdGEiLCJidWNrZXRzIiwiZXJyb3IiLCJzdG9yYWdlIiwibGlzdEJ1Y2tldHMiLCJjb25zb2xlIiwiYnVja2V0RXhpc3RzIiwic29tZSIsImJ1Y2tldCIsIm5hbWUiLCJjcmVhdGVFcnJvciIsImNyZWF0ZUJ1Y2tldCIsInB1YmxpYyIsImFsbG93ZWRNaW1lVHlwZXMiLCJmaWxlU2l6ZUxpbWl0IiwibG9nIiwidXBsb2FkU2luZ2xlRmlsZSIsImZpbGVBcnJheSIsInR5cGUiLCJ1c2VybmFtZSIsInBvc3RJbmRleCIsIm9yaWdpbmFsTmFtZSIsIm9yaWdpbmFsRmlsZW5hbWUiLCJmaWxlU2l6ZSIsInNpemUiLCJleGlzdHNTeW5jIiwiZmlsZXBhdGgiLCJ1bmxpbmtTeW5jIiwic3VjY2VzcyIsInNhZmVPcmlnaW5hbE5hbWUiLCJmaWxlRXh0ZW5zaW9uIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInJhbmRvbVN0cmluZyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsImZpbGVOYW1lIiwiZm9sZGVyUGF0aCIsImZpbGVQYXRoIiwiZmlsZUJ1ZmZlciIsInJlYWRGaWxlU3luYyIsInVwbG9hZERhdGEiLCJ1cGxvYWRFcnJvciIsImZyb20iLCJ1cGxvYWQiLCJjb250ZW50VHlwZSIsInVwc2VydCIsImRldGFpbHMiLCJtZXNzYWdlIiwidXJsRGF0YSIsImdldFB1YmxpY1VybCIsInVybCIsInB1YmxpY1VybCIsIm1pbWVUeXBlIiwiZmlsZUVycm9yIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJidWNrZXRSZWFkeSIsImZvcm0iLCJtYXhGaWxlU2l6ZSIsIm1heEZpbGVzIiwiYWxsb3dFbXB0eUZpbGVzIiwibWluRmlsZVNpemUiLCJtdWx0aXBsZXMiLCJwYXJzZSIsImVyciIsImZpZWxkcyIsImZpbGVzIiwiY29kZSIsIkFycmF5IiwiaXNBcnJheSIsImZpbGUiLCJsZW5ndGgiLCJ1cGxvYWRQcm9taXNlcyIsImZpbGVzVG9Qcm9jZXNzIiwiZm9yRWFjaCIsImluZGV4IiwicHVzaCIsInRoZW4iLCJyZXN1bHQiLCJvcmRlciIsInJlc3VsdHMiLCJQcm9taXNlIiwiYWxsU2V0dGxlZCIsInN1Y2Nlc3NmdWxVcGxvYWRzIiwiZmFpbGVkVXBsb2FkcyIsInZhbHVlIiwicmVzcG9uc2UiLCJ0b3RhbEZpbGVzIiwic3VjY2Vzc2Z1bCIsImZhaWxlZCIsInVwbG9hZHMiLCJlcnJvcnMiLCJiYXRjaEVycm9yIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/upload.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fupload&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cupload.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();